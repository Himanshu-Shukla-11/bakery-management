{% extends "app/base.html" %}
{% block content %}

<head>
<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
    }
</style>

</head>
<body>
    <div class="container-xxl py-6">
        <div class="container">
            <div class="bg-primary text-light rounded-bottom p-5 my-6 mt-0 wow fadeInUp" data-wow-delay="0.1s">
                <div class="row g-4 align-items-center">
                    <div class="col-lg-12">
                        <center><h2 class="display-4 text-light mb-0">My Orders</h2></center>
                    </div>
                </div>
            </div>
        {% if cancelled_message %}
            <center><h4>{{ cancelled_message }}</h4></center>
        {% else %}
            <div class="form-floating">
                <h3><u>Completed Orders</u></h3><br>
            </div>
            {% if completed_orders %}
            <table>
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Quantity</th>
                        <th>Total Price</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in completed_orders %}
                        {% for item in order.orderitem_set.all %}
                            <tr>
                                <td>{{ item.product.product_name }}</td>
                                <td>{{ item.quantity }}</td>
                                <td>₹{{ item.subtotal }}</td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No completed orders found.</p>
        {% endif %}
        <br>
        <div class="form-floating">
            <h3><u>Pending Orders</u></h3><br>
        </div>

        {% if pending_orders %}
        <table>
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Quantity</th>
                    <th>Total Price</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for order in pending_orders %}
                    {% for item in order.orderitem_set.all %}
                        <tr>
                            <td>{{ item.product.product_name }}</td>
                            <td>{{ item.quantity }}</td>
                            {% if forloop.first %}
                                <td rowspan="{{ order.orderitem_set.count }}">₹{{ order.total_price }}</td>
                            {% endif %}
                            
                            {% if forloop.first %}
                                <td rowspan="{{ order.orderitem_set.count }}">
                                    <form action="{% url 'cancel_order' order.id %}" method="POST">
                                        {% csrf_token %}
                                        <button class="btn btn-primary rounded-pill py-2 px-3" type="submit">Cancel Order</button>
                                    </form>
                                </td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                {% endfor %}
            </tbody>
        </table>

        {% elif processing_orders %}
        <table>
            <h5>Your Orders is Processing</h5><br>
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Quantity</th>
                    <th>Total Price</th>
                </tr>
            </thead>
            <tbody>
                {% for order in processing_orders %}
                    {% for item in order.orderitem_set.all %}
                        <tr>
                            <td>{{ item.product.product_name }}</td>
                            <td>{{ item.quantity }}</td>
                            {% if forloop.first %}
                                <td rowspan="{{ order.orderitem_set.count }}">{{ order.total_price }}</td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No pending orders found.</p>
        
    {% endif %}
{% endif %}



<!-- Other content -->

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Add event listener for cancel order buttons
        const cancelOrderButtons = document.querySelectorAll(".cancel-order-btn");
        cancelOrderButtons.forEach(btn => {
            btn.addEventListener("click", function() {
                const orderId = this.getAttribute("data-order-id");
                const form = document.getElementById(`cancel-form-${orderId}`);
                if (confirm("Are you sure you want to cancel this order?")) {
                    form.submit();
                }
            });
        });
    });
</script>
        </div>
    </div>

</body>

{% endblock %}
